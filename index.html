<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Jornal 7ºA Desidério</title>
    <link rel="icon" type="image/png" href="image_1352a2.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@300;400;700&family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    
    <style>
        /* ESTILOS GERAIS E VISUAIS (100% PRESERVADOS) */
        body { font-family: 'Exo 2', sans-serif; background-color: #050608; color: #d1d5db; scroll-behavior: smooth; }
        .font-orbitron { font-family: 'Orbitron', sans-serif; }
        .glass-card { background: rgba(15, 23, 42, 0.5); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid rgba(56, 189, 248, 0.2); transition: all 0.3s ease; }
        .glass-card:hover { border-color: rgba(56, 189, 248, 0.5); box-shadow: 0 0 20px rgba(56, 189, 248, 0.2); }
        .input-field { background: rgba(15, 23, 42, 0.5); border: 1px solid rgba(56, 189, 248, 0.2); transition: all 0.3s ease; }
        .input-field:focus { border-color: rgba(56, 189, 248, 0.8); box-shadow: 0 0 15px rgba(56, 189, 248, 0.3); outline: none; }
        .news-content { white-space: pre-line; }
        .hidden { display: none !important; }

        /* ESTILOS DO CALENDÁRIO */
        .day-label { position: absolute; bottom: 4px; left: 0; right: 0; font-size: 0.7rem; font-weight: bold; line-height: 1; text-align: center; padding: 0 2px; }
        .day-number-wrapper { width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; border-radius: 50%; z-index: 1; }
        .event-prova { background-color: rgba(236, 72, 153, 0.8); color: #fff; border: 1px solid #ec4899; }
        .event-prova-cancelada { background-color: #be185d; color: #fff; font-weight: bold; border: 1px solid #ec4899; }
        .event-evento { background-color: rgba(168, 85, 247, 0.8); color: #fff; border: 1px solid #a855f7; }
        .event-feriado { background-color: rgba(5, 150, 105, 0.8); color: #fff; border: 1px solid #059669; }

        /* ESTRATÉGIA DE LOGIN: Bloqueio total da tela */
        #login-section { position: fixed; inset: 0; z-index: 100; }
        body.no-scroll { overflow: hidden; }
        
        /* ANIMAÇÕES DO POP-UP */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes zoomIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes slideInUp { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .popup-content > * { opacity: 0; }
        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
        .animate-zoom-in { animation: zoomIn 1s ease-out 0.3s forwards; } 
        .animate-slide-in-up { animation: slideInUp 0.8s ease-out forwards; }
    </style>
</head>

</footer>

</div> <script src="jornal-data.js"></script> 

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- CONSTANTES GLOBAIS ---
        const loginSection = document.getElementById('login-section');
        const mainContent = document.getElementById('main-content');
        const loginForm = document.getElementById('login-form');
        const submitButton = document.getElementById('submit-button');
        const formMessage = document.getElementById('form-message');
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        const newsContainer = document.getElementById('news-container');
        const timetableBody = document.getElementById('timetable-body');
        const calendarGrid = document.getElementById('calendar-grid');
        const monthYearTitle = document.getElementById('month-year-title');
        const prevMonthBtn = document.getElementById('prev-month');
        const nextMonthBtn = document.getElementById('next-month');
        let currentDate = new Date();

        // --- FUNÇÕES DE RENDERIZAÇÃO DE CONTEÚDO ---
        function renderNews() {
            if (!newsContainer || !window.siteData || !siteData.noticias) { if(newsContainer) newsContainer.innerHTML = '<p class="text-red-500">Erro ao carregar notícias.</p>'; return; }
            newsContainer.innerHTML = '';
            siteData.noticias.slice().reverse().forEach(post => {
                const postEl = document.createElement('article');
                postEl.className = 'glass-card rounded-xl overflow-hidden';
                postEl.innerHTML = `<div class="p-6"><div class="flex items-center text-sm text-slate-400 mb-3"><span class="bg-sky-500/20 text-sky-300 font-bold text-xs px-2.5 py-1 rounded-full">${post.category.toUpperCase()}</span><span class="mx-2">•</span><span>${new Date(post.date + 'T00:00:00').toLocaleDateString('pt-BR')}</span></div><h3 class="text-xl font-bold mb-3 text-white font-orbitron">${post.title}</h3><p class="text-slate-300 font-light news-content">${post.content}</p></div>`;
                newsContainer.appendChild(postEl);
            });
        }

        function renderTimetable() {
            if (!timetableBody || !window.siteData || !siteData.horarios) { if(timetableBody) timetableBody.innerHTML = '<tr><td colspan="6" class="text-red-500 text-center p-4">Erro ao carregar horários.</td></tr>'; return; }
            timetableBody.innerHTML = '';
            siteData.horarios.forEach(row => {
                const rowEl = document.createElement('tr');
                rowEl.className = "border-b border-slate-800";
                rowEl.innerHTML = `<td class="py-3 px-4 font-bold text-white">${row.horario}</td><td>${row.segunda}</td><td>${row.terca}</td><td>${row.quarta}</td><td>${row.quinta}</td><td>${row.sexta}</td>`;
                timetableBody.appendChild(rowEl);
            });
        }

        function renderCalendar(date) {
            if (!calendarGrid || !window.siteData || !monthYearTitle) return;
            const month = date.getMonth();
            const year = date.getFullYear();
            const monthNames = ["Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"];
            monthYearTitle.textContent = `${monthNames[month]} // ${year}`;
            calendarGrid.innerHTML = '';
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            for (let i = 0; i < firstDay; i++) calendarGrid.insertAdjacentHTML('beforeend', '<div></div>');
            for (let day = 1; day <= daysInMonth; day++) {
                let dayClasses = 'day-number-wrapper';
                let label = '';
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const event = siteData.eventos ? siteData.eventos.find(e => e.date === dateStr) : null;
                if (event) {
                    dayClasses += ` event-${event.type}`;
                    label = `<div class="day-label">${event.title}</div>`;
                }
                calendarGrid.insertAdjacentHTML('beforeend', `<div class="text-center h-20 flex flex-col justify-start items-center p-1 relative"><div class="${dayClasses}">${day}</div>${label}</div>`);
            }
        }

        function showWelcomePopup() {
            const popup = document.getElementById('welcome-popup');
            const closeButton = document.getElementById('close-popup');
            if (!popup || !closeButton) return;
            popup.style.display = 'flex';
            popup.classList.add('animate-fade-in');
            closeButton.addEventListener('click', () => popup.style.display = 'none');
            setTimeout(() => { if (popup.style.display !== 'none') popup.style.display = 'none'; }, 6000);
        }

        // LÓGICA DE ESPERA PACIENTE
        function initializeContent() {
            if (typeof siteData !== 'undefined') {
                renderNews();
                renderTimetable();
                renderCalendar(currentDate);
            } else {
                setTimeout(initializeContent, 100);
            }
        }

        // LÓGICA DE LOGIN SEGURA, USANDO O "COFRE" DO NETLIFY
        loginForm.addEventListener('submit', async function(event) {
            event.preventDefault();
            submitButton.disabled = true;
            submitButton.textContent = 'Enviando...';
            formMessage.style.display = 'none';

            const url = `/.netlify/functions/submit-form`;
            const dataToSend = {
                baseId: 'app3Z2bJrTyMK2hHz',
                tableId: 'tblMhy6a1JaEV5Jbe',
                nome: document.getElementById('nome-input').value,
                sala: document.getElementById('sala-input').value,
                email: document.getElementById('email-input').value
            };

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(dataToSend)
                });

                if (response.ok) {
                    loginSection.classList.add('hidden');
                    mainContent.classList.remove('hidden');
                    document.body.classList.remove('no-scroll');
                    window.scrollTo(0, 0);
                    initializeContent(); // <--- A FUNÇÃO DE ESPERA É CHAMADA AQUI
                    showWelcomePopup();
                } else {
                    const errorData = await response.json();
                    let errorMessage = `Ocorreu um erro (${response.status}).`;
                    if (errorData.error && errorData.error.message) errorMessage = errorData.error.message;
                    formMessage.textContent = `Erro: ${errorMessage}`;
                    formMessage.style.color = '#ef4444';
                    formMessage.style.display = 'block';
                }
            } catch (error) {
                formMessage.textContent = 'Erro de conexão. Verifique sua internet.';
                formMessage.style.color = '#ef4444';
                formMessage.style.display = 'block';
            } finally {
                submitButton.disabled = false;
                submitButton.textContent = 'Acessar';
            }
        });

        // LÓGICA DO MENU E CALENDÁRIO
        if (mobileMenuButton) mobileMenuButton.addEventListener('click', () => mobileMenu.classList.toggle('hidden'));
        if(prevMonthBtn) prevMonthBtn.addEventListener('click', () => { currentDate.setMonth(currentDate.getMonth() - 1); renderCalendar(currentDate); });
        if(nextMonthBtn) nextMonthBtn.addEventListener('click', () => { currentDate.setMonth(currentDate.getMonth() + 1); renderCalendar(currentDate); });
    });
</script>

</body>
</html>
</html>
